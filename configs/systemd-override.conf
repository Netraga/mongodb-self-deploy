# MongoDB systemd service override configuration
# Place this file in /etc/systemd/system/mongod.service.d/override.conf

[Service]
# File descriptor limits
LimitNOFILE=64000
LimitNPROC=64000

# Memory limits
# Adjust based on your server's RAM (example: 8GB limit)
MemoryLimit=8G

# CPU scheduling
CPUSchedulingPolicy=fifo
CPUSchedulingPriority=1

# I/O scheduling
IOSchedulingClass=realtime
IOSchedulingPriority=0

# Restart policy
Restart=always
RestartSec=10
StartLimitInterval=300
StartLimitBurst=5

# Security hardening
PrivateTmp=true
ProtectSystem=full
ProtectHome=true
NoNewPrivileges=true

# Process management
KillMode=control-group
KillSignal=SIGTERM
SendSIGKILL=yes
TimeoutStartSec=120
TimeoutStopSec=120

# Working directory
WorkingDirectory=/var/lib/mongodb

# Environment variables
Environment="MALLOC_ARENA_MAX=2"

# Nice level (process priority)
Nice=-5

# Core dump settings
LimitCORE=infinity

# Task accounting
TasksAccounting=true
TasksMax=32768